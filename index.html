<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒãƒ¼</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+JP:wght@300;400&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #080a0f;
    --surface: #0d1117;
    --accent: #00e5ff;
    --accent2: #ff4081;
    --text: #e8eaf6;
    --muted: #546e7a;
    --glow: 0 0 20px rgba(0,229,255,0.4), 0 0 60px rgba(0,229,255,0.15);
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Sans JP', sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,229,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,229,255,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events: none;
  }

  body::after {
    content: '';
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%,-50%);
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(0,229,255,0.06) 0%, transparent 70%);
    pointer-events: none;
  }

  .container {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 900px;
    padding: 40px 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 32px;
  }

  h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(1.2rem, 3vw, 1.8rem);
    letter-spacing: 0.4em;
    color: var(--accent);
    text-shadow: var(--glow);
    text-transform: uppercase;
  }

  /* â”€â”€ Settings panel â”€â”€ */
  .settings {
    background: var(--surface);
    border: 1px solid rgba(0,229,255,0.15);
    border-radius: 4px;
    padding: 24px 32px;
    display: flex;
    flex-wrap: wrap;
    gap: 16px 28px;
    align-items: flex-end;
    justify-content: center;
    width: 100%;
    transition: opacity 0.3s;
  }

  /* When running, dim inputs but keep buttons clickable */
  .settings.running {
    opacity: 0.5;
  }
  .settings.running input {
    pointer-events: none;
  }

  .field {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  label {
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    color: var(--muted);
    text-transform: uppercase;
  }

  input[type="date"],
  input[type="time"] {
    background: #111820;
    border: 1px solid rgba(0,229,255,0.2);
    border-radius: 3px;
    color: var(--text);
    padding: 10px 14px;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 0.05em;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    cursor: pointer;
  }

  input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 2px rgba(0,229,255,0.1);
  }

  input[type="date"]::-webkit-calendar-picker-indicator,
  input[type="time"]::-webkit-calendar-picker-indicator {
    filter: invert(1) opacity(0.4);
    cursor: pointer;
  }

  .btn-row {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  button {
    background: var(--accent);
    color: #000;
    border: none;
    border-radius: 3px;
    padding: 11px 28px;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1rem;
    letter-spacing: 0.2em;
    cursor: pointer;
    transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
  }

  button:hover { background: #29f3ff; box-shadow: var(--glow); }
  button:active { transform: scale(0.97); }

  button.reset-btn {
    background: transparent;
    color: var(--accent2);
    border: 1px solid var(--accent2);
  }
  button.reset-btn:hover {
    background: rgba(255,64,129,0.1);
    box-shadow: 0 0 16px rgba(255,64,129,0.3);
  }

  /* â”€â”€ Countdown display â”€â”€ */
  .display { text-align: center; }

  .digits {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(3.5rem, 14vw, 9rem);
    letter-spacing: 0.05em;
    color: var(--accent);
    text-shadow: var(--glow);
    line-height: 1;
    transition: color 0.3s, text-shadow 0.3s;
  }

  .digits.warning {
    color: #ffb300;
    text-shadow: 0 0 20px rgba(255,179,0,0.5), 0 0 60px rgba(255,179,0,0.2);
  }
  .digits.danger {
    color: var(--accent2);
    text-shadow: 0 0 20px rgba(255,64,129,0.6), 0 0 60px rgba(255,64,129,0.2);
    animation: pulse 0.5s ease-in-out infinite alternate;
  }
  .digits.finished {
    color: #69ff47;
    text-shadow: 0 0 20px rgba(105,255,71,0.6), 0 0 60px rgba(105,255,71,0.2);
    animation: none;
  }

  @keyframes pulse {
    from { opacity: 1; }
    to   { opacity: 0.6; }
  }

  .segment-labels {
    display: flex;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 0.15em;
    color: var(--muted);
    margin-top: 6px;
    justify-content: center;
    visibility: hidden;
  }
  .segment-labels.show { visibility: visible; }
  .seg { text-align: center; min-width: 110px; }

  .sub-label {
    font-size: 0.65rem;
    letter-spacing: 0.3em;
    color: var(--muted);
    margin-top: 12px;
    text-transform: uppercase;
    min-height: 1.2em;
  }

  .target-display {
    font-size: 0.8rem;
    color: var(--muted);
    letter-spacing: 0.1em;
    margin-top: 8px;
    min-height: 1.4em;
  }
  .target-display span {
    color: var(--accent);
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1rem;
    letter-spacing: 0.15em;
  }

  .finished-msg {
    display: none;
    font-size: 1.4rem;
    letter-spacing: 0.3em;
    color: #69ff47;
    text-shadow: 0 0 20px rgba(105,255,71,0.5);
    font-family: 'Bebas Neue', sans-serif;
    margin-top: 10px;
    animation: fadeIn 0.5s ease;
  }

  .progress-wrap {
    width: 100%;
    max-width: 600px;
    height: 2px;
    background: rgba(0,229,255,0.1);
    border-radius: 2px;
    overflow: hidden;
  }
  .progress-bar {
    height: 100%;
    background: var(--accent);
    box-shadow: var(--glow);
    transition: width 0.1s linear, background 0.3s;
    width: 0%;
  }
  .progress-bar.warning  { background: #ffb300; }
  .progress-bar.danger   { background: var(--accent2); }
  .progress-bar.finished { background: #69ff47; width: 100%; }

  /* Auto-save badge */
  .save-badge {
    position: fixed;
    bottom: 20px; right: 24px;
    font-size: 0.6rem;
    letter-spacing: 0.2em;
    color: var(--accent);
    text-transform: uppercase;
    opacity: 0;
    transition: opacity 0.4s;
    pointer-events: none;
  }
  .save-badge.show { opacity: 1; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>
<div class="container">
  <h1>â± Countdown</h1>

  <div class="settings" id="settingsPanel">
    <div class="field">
      <label>ç›®æ¨™æ—¥ä»˜</label>
      <input type="date" id="dateInput" onchange="saveSettings()">
    </div>
    <div class="field">
      <label>ç›®æ¨™æ™‚åˆ»</label>
      <input type="time" id="timeInput" step="1" onchange="saveSettings()">
    </div>
    <div class="btn-row">
      <button id="startBtn" onclick="startCountdown()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button class="reset-btn" id="resetBtn" onclick="resetCountdown()" style="display:none">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
  </div>

  <div class="display">
    <div class="digits" id="digits">--:--:--</div>
    <div class="segment-labels" id="segLabels">
      <div class="seg" id="seg0">HRS</div>
      <div class="seg" id="seg1">MIN</div>
      <div class="seg" id="seg2">SEC</div>
      <div class="seg" id="seg3" style="display:none"></div>
    </div>
    <div class="sub-label" id="subLabel">æ—¥ä»˜ã¨æ™‚åˆ»ã‚’è¨­å®šã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆ</div>
    <div class="target-display" id="targetDisplay"></div>
    <div class="finished-msg" id="finishedMsg">ğŸ‰ TIME'S UP ! ğŸ‰</div>
  </div>

  <div class="progress-wrap">
    <div class="progress-bar" id="progressBar"></div>
  </div>
</div>

<div class="save-badge" id="saveBadge">âœ“ è‡ªå‹•ä¿å­˜æ¸ˆã¿</div>

<script>
  const STORAGE_KEY  = 'countdown_target';
  const DURATION_KEY = 'countdown_duration';

  let intervalId    = null;
  let targetTime    = null;
  let totalDuration = null;

  const pad = n => String(n).padStart(2, '0');

  // â”€â”€ Storage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function saveSettings() {
    const d = document.getElementById('dateInput').value;
    const t = document.getElementById('timeInput').value;
    if (d && t) {
      localStorage.setItem(STORAGE_KEY, `${d}T${t}`);
      flashBadge();
    }
  }

  function loadSavedTarget() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (!saved) return null;
    const [datePart, timePart] = saved.split('T');
    document.getElementById('dateInput').value = datePart || '';
    document.getElementById('timeInput').value = timePart || '';
    return new Date(saved);
  }

  function flashBadge() {
    const b = document.getElementById('saveBadge');
    b.classList.add('show');
    clearTimeout(b._t);
    b._t = setTimeout(() => b.classList.remove('show'), 1800);
  }

  // â”€â”€ UI helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setRunning(on) {
    document.getElementById('settingsPanel').classList.toggle('running', on);
    document.getElementById('startBtn').style.display = on ? 'none' : '';
    document.getElementById('resetBtn').style.display = on ? ''     : 'none';
  }

  // â”€â”€ Start â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function startCountdown(savedTarget) {
    let target = savedTarget;

    if (!target) {
      const dateVal = document.getElementById('dateInput').value;
      const timeVal = document.getElementById('timeInput').value;
      if (!dateVal || !timeVal) { alert('æ—¥ä»˜ã¨æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
      target = new Date(`${dateVal}T${timeVal}`);
      if (isNaN(target))        { alert('ç„¡åŠ¹ãªæ—¥æ™‚ã§ã™'); return; }
      if (target <= new Date()) { alert('æœªæ¥ã®æ—¥æ™‚ã‚’è¨­å®šã—ã¦ãã ã•ã„'); return; }
      saveSettings();
      totalDuration = target - new Date();
      localStorage.setItem(DURATION_KEY, totalDuration);
    } else {
      const saved = Number(localStorage.getItem(DURATION_KEY));
      totalDuration = saved > 0 ? saved : (target - new Date());
    }

    if (intervalId) clearInterval(intervalId);
    targetTime = target;

    setRunning(true);
    document.getElementById('finishedMsg').style.display = 'none';
    document.getElementById('targetDisplay').innerHTML =
      `ç›®æ¨™: <span>${target.toLocaleDateString('ja-JP')} ${target.toLocaleTimeString('ja-JP')}</span>`;

    tick();
    intervalId = setInterval(tick, 100);
  }

  // â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function resetCountdown() {
    if (intervalId) { clearInterval(intervalId); intervalId = null; }

    localStorage.removeItem(DURATION_KEY);
    // Keep STORAGE_KEY so inputs remember the last date/time

    targetTime = totalDuration = null;

    document.getElementById('digits').textContent        = '--:--:--';
    document.getElementById('digits').className          = 'digits';
    document.getElementById('segLabels').classList.remove('show');
    document.getElementById('subLabel').textContent      = 'æ—¥ä»˜ã¨æ™‚åˆ»ã‚’è¨­å®šã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆ';
    document.getElementById('targetDisplay').innerHTML   = '';
    document.getElementById('finishedMsg').style.display = 'none';
    document.getElementById('progressBar').style.width   = '0%';
    document.getElementById('progressBar').className     = 'progress-bar';

    setRunning(false);
  }

  // â”€â”€ Tick â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function tick() {
    const diff = targetTime - new Date();

    if (diff <= 0) {
      clearInterval(intervalId); intervalId = null;
      localStorage.removeItem(DURATION_KEY);

      document.getElementById('digits').textContent    = '00:00:00.0';
      document.getElementById('digits').className      = 'digits finished';
      document.getElementById('progressBar').className = 'progress-bar finished';
      document.getElementById('subLabel').textContent  = 'å®Œäº†ï¼';
      document.getElementById('finishedMsg').style.display = 'block';
      document.getElementById('segLabels').classList.remove('show');
      setRunning(false);
      return;
    }

    const totalSec = diff / 1000;
    const days   = Math.floor(totalSec / 86400);
    const hrs    = Math.floor((totalSec % 86400) / 3600);
    const mins   = Math.floor((totalSec % 3600) / 60);
    const secs   = totalSec % 60;
    const tenths = Math.floor((secs % 1) * 10);

    document.getElementById('segLabels').classList.add('show');

    let display;
    if (days > 0) {
      display = `${String(days).padStart(2,'0')}:${pad(hrs)}:${pad(mins)}:${pad(Math.floor(secs))}`;
      document.getElementById('seg0').textContent   = 'DAYS';
      document.getElementById('seg1').textContent   = 'HRS';
      document.getElementById('seg2').textContent   = 'MIN';
      document.getElementById('seg3').textContent   = 'SEC';
      document.getElementById('seg3').style.display = '';
    } else {
      display = `${pad(hrs)}:${pad(mins)}:${pad(Math.floor(secs))}.${tenths}`;
      document.getElementById('seg0').textContent   = 'HRS';
      document.getElementById('seg1').textContent   = 'MIN';
      document.getElementById('seg2').textContent   = 'SEC';
      document.getElementById('seg3').style.display = 'none';
    }

    document.getElementById('digits').textContent = display;

    const progress = totalDuration > 0
      ? Math.max(0, Math.min(100, (1 - diff / totalDuration) * 100)) : 0;
    document.getElementById('progressBar').style.width = progress + '%';

    let state = '';
    if (totalSec <= 10)      state = 'danger';
    else if (totalSec <= 60) state = 'warning';

    document.getElementById('digits').className      = 'digits'       + (state ? ' '+state : '');
    document.getElementById('progressBar').className = 'progress-bar' + (state ? ' '+state : '');

    if (days > 0) {
      document.getElementById('subLabel').textContent = `æ®‹ã‚Š ${days}æ—¥ ${hrs}æ™‚é–“ ${mins}åˆ†`;
    } else if (hrs > 0) {
      document.getElementById('subLabel').textContent = `æ®‹ã‚Š ${hrs}æ™‚é–“ ${mins}åˆ† ${Math.floor(secs)}ç§’`;
    } else if (mins > 0) {
      document.getElementById('subLabel').textContent = `æ®‹ã‚Š ${mins}åˆ† ${Math.floor(secs)}ç§’`;
    } else {
      document.getElementById('subLabel').textContent = 'æ®‹ã‚Šã‚ãšã‹...';
    }
  }

  // â”€â”€ Init: auto-resume on page load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  (function init() {
    const saved = loadSavedTarget();

    if (saved && !isNaN(saved)) {
      if (saved > new Date()) {
        startCountdown(saved);
      } else {
        // Target already passed
        document.getElementById('digits').textContent    = '00:00:00.0';
        document.getElementById('digits').className      = 'digits finished';
        document.getElementById('progressBar').className = 'progress-bar finished';
        document.getElementById('subLabel').textContent  = 'å®Œäº†ï¼';
        document.getElementById('finishedMsg').style.display = 'block';
        document.getElementById('targetDisplay').innerHTML =
          `ç›®æ¨™: <span>${saved.toLocaleDateString('ja-JP')} ${saved.toLocaleTimeString('ja-JP')}</span>`;
        localStorage.removeItem(DURATION_KEY);
        // Show reset button so user can clear the finished state
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('resetBtn').style.display = '';
      }
    } else {
      // No saved data â†’ default (today +1hr)
      const now = new Date();
      document.getElementById('dateInput').value = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}`;
      document.getElementById('timeInput').value = `${pad((now.getHours()+1)%24)}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
    }
  })();
</script>
</body>
</html>
